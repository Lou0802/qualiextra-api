SPRINT 0 INITIALISATION PROJET

Ce projet est une API Back-End développée pour le test technique Qualiextra et il est construit en Node.js + Express.
Dans le Sprint 0, l’objectif principal était de mettre en place la structure initiale du projet. 

Ce qui a été fait dans le Sprint 0
	•	Initialisation du projet Node.js
               npm init -y
	•	Création du serveur Express fonctionnel
                 app.js/server.js
	•	Organisation des dossiers (config, models, routes)
	•	Installation et configuration de Nodemon pour le dev
	•	Route de test /health pour vérifier le serveur

Structure du projet
 .
 ├── .env           # variables d’environnement
 ├── .gitignore     # fichiers à ignorer par Git
 ├── package.json   # dépendances et scripts
 ├──
src/
 ├── app.js        # configuration Express 
 ├── server.js     # point d’entrée du serveur
 ├── config/       # configuration de la DB
 ├── models/       # modèles Sequelize
 └── routes/       # routes API

 Dépendances installées
 npm install express dotenv
 npm i
 npm install -D nodemon

Le serveur démarre sur le port défini dans .env

Scripts utiles après modification de package.json :
Pour démarrer le serveur en mode développement avec rechargement automatique :
    npm run dev
Pour démarrer le serveur en mode production :
    npm start

	

SPRINT 1  BASE DE DONNEES ET MODEL USER ET ROLES

Dans le Sprint 1 l’objectif était de connecter le projet à PostgreSQL et mettre en place Sequelize avec un modèle User pour préparer l’authentification.

Ce qui a été fait dans le Sprint 1
    •	Installer les dépendences Sequelize et pg
	•	Connexion à la base de donnéesPostgreSQL 
              psql -U postgres
	•	Création du rôle PostgreSQL avec mot de passe 
	•	Création de la base de données 
	•	Configuration Sequelize 
    •	Configuration des variables d’environnement pour la DB
    •	Tester la connexion à la DB depuis l’application
    •	Création du modèle User avec gestion du rôle (USER / ADMIN) 
	•	Test de connexion et synchronisation de la table Users 

Dépendances installées
npm install sequelize pg

Base de données PostgreSQL
CREATE ROLE nom_user WITH LOGIN PASSWORD 'mon_mot_de_passe';
CREATE DATABASE nom_db OWNER nom_user;
GRANT ALL PRIVILEGES ON DATABASE qualiextra_db TO nom_user;


Sprint 2 INSCRIPTION UTILISATEUR

L’objectif du Sprint 2 était de mettre en place la création sécurisée d’un compte utilisateur via la route pour l’inscription.
            POST /api/auth/register

Ce qui a été fait dans le Sprint 2

	•	Validation des données (prénom, nom, email et mot de passe obligatoires)
	•	Vérification de l’email
	•	refuse l’inscription si l’email existe déjà
	•	Hash du mot de passe
    •	Token de vérification
	•	génération d’un token unique pour la vérification email
		emailVerified = false par défaut
	
Dépendances utilisées
npm install argon2 
	

  Sprint 3 – Authentification & Routes protégées

L’objectif du sprint 3 est de mettre en place l’authentification des utilisateurs à l’aide de JWT (JSON Web Token) et de sécuriser l’accès à certaines routes de l’API.

Ce qui a été fait dans le Sprint 3

    •	Création de la route 
         POST /api/auth/login
    •	Vérification des informations d’identification (email et mot de passe)
    •	Utilisation d’argon2 pour vérifier le mot de passe hashé
    •	Si les informations sont valides, génération d’un token JWT
    •	Création d’un middleware pour vérifier le token JWT dans les requêtes         entrantes
    •	Le middleware protège les routes sensibles en vérifiant la validité du token
    •	Si le token est valide, l’utilisateur est autorisé à accéder à la ressource demandée
    •	Restriction d’accès basée sur la vérification de l’email
    •   Une route privée /private est accessible uniquement aux utilisateurs authentifiés
        GET /api/private
        Reponse:"message": "Hello, Sarah !" ok (verification postman)
    •	Restriction d’accès basée sur la vérification de l’email
    •	Seuls les utilisateurs avec un email vérifié peuvent accéder à certaines routes protégées

Dépendances utilisées
npm install jsonwebtoken


SPRINT 4 AUTORISATION BASEES SUR LES ROLES

L objectif de ce Sprint 4 est d utiliser les rôles déjà existants pour restreindre l’accès aux ressources.

Ce qui a été fait dans le Sprint 4

	•	Création du middleware isAdmin
	•	Vérification du rôle depuis le JWT
	•	Sécurisation des routes sensibles
	•	Différenciation des permissions USER / ADMIN
            src/controllers/user.controller.js
	•	Mise en place des routes de gestion des utilisateurs

Routes protégées

 Routes réservées aux ADMIN

GET
/api/users
Lister tous les utilisateurs
GET
/api/users/:id
Voir un utilisateur par ID
PUT
/api/users/:id
Modifier un utilisateur
DELETE
/api/users/:id
Supprimer un utilisateur

Routes accessibles aux USER

GET
/api/me
Voir son propre profil
PUT
/api/me
Modifier son propre profil


SPRINT 5 VERIFICATION EMAIL
    
L’objectif du Sprint 5 est de finaliser  le processus de validation email.
Le token de vérification et le champ emailVerified sont créés dès l’inscription.
Le sprint suivant consiste à ajouter la route qui permet de valider réellement l’email et d’activer le compte.

Ce qui a été fait dans le Sprint 4

Route /verify-email
	•	Validation du token email
	•	Passage de emailVerified à true
	•	Suppression du token après validation
	•	Blocage des emails temporaires à l’inscription



TEST
CREER UN UTILISATEUR
POST http://localhost:3000/api/auth/register

{
  "firstname": "Admin",
  "lastname": "Test",
  "email": "admin@test.com",
  "password": "password123"
}

{
    "message": "Utilisateur enregistré avec succès. Veuillez vérifier votre email."
}

VERIFIER L EMAIL
Postgres
SELECT email, "emailVerificationToken"
FROM "Users"
WHERE email = 'admin@test.com';

GET http://localhost:3000/api/auth/verify-email?token=VOTRE_TOKEN

{
    "message": "Email vérifié avec succès. Vous pouvez maintenant vous connecter."
}

LOGIN
POST http://localhost:3000/api/auth/login


  {
  "email": "admin@test.com",
  "password": "password123"
}

{
  "token": "..."
}

PASSER L UTILISATEUR EN ADMIN 
Postgres
UPDATE "Users"
SET role = 'ADMIN'
WHERE email = 'admin@test.com';

Vérification
SELECT email, role FROM "Users";

admin@test.com | ADMIN affichage

ROUTE ADMIN
GET http://localhost:3000/api/users

headers
Authorization: Bearer VOTRE_TOKEN_ADMIN

[
    {
        "id": 1,
        "firstname": "Admin",
        "lastname": "Test",
        "email": "admin@test.com"
        "role": "ADMIN",

    }

ROUTE private

GET http://localhost:3000/api/private

headers
Authorization: Bearer VOTRE_TOKEN_ADMIN

{
    "message": "Hello, Admin !"
}

TEST UTILISATEUR NON ADMIN
GET http://localhost:3000/api/users

{
  "firstname": "User",
  "lastname": "Test",
  "email": "user@test.com",
  "password": "password123"
}

{
  "message": "Accès interdit"
}



A ce sprint a ete ajouté la validation de l’email à l’inscription. Un token de vérification est généré et envoyé par email à l’utilisateur. L’utilisateur doit cliquer sur le lien de vérification pour activer son compte. Seuls les utilisateurs avec un email vérifié peuvent se connecter et accéder aux ressources protégées.

Dépendances utilisées
npm install nodemailer

service d’envoi d’email
Pour l’envoi d’emails, j’ai utilisé Nodemailer avec un compte Mailtrap pour les tests. Mailtrap permet de capturer les emails envoyés depuis l’application sans les envoyer à de vrais destinataires, ce qui est idéal pour le développement et les tests.


SPRINT 6 DEPLOYEMENT DOCKER ET RENDER

Objectif du Sprint 6 était de rendre le projet déployable en production en utilisant Docker pour containeriser l’application et Render pour l’héberger, tout en assurant la sécurité des variables sensibles.

Ce qui a été fait dans le Sprint 6

  •	Création d’un Dockerfile pour containeriser l’application
  •	Création d’un compte Render et configuration du projet
  •	Déploiement de l’application sur Render
  •	Gestion des variables d’environnement de manière sécurisée sur Render
  

